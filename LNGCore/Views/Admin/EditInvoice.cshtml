@model LNGCore.UI.Models.Admin.EditInvoiceViewModel
@{
    ViewData["Title"] = "EditInvoice";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<script>
    function addLinesToTable() {
        var index = $("#lineIndex").val();
        var invoiceId = $("#invoiceId").val();
        $.ajax({
            url: "@Html.Raw(Url.Action("GetInvoiceLines", "Admin", new {invoiceId ="__INVC__", startingIndex="__STRT__"}))".replace("__INVC__", invoiceId).replace("__STRT__", index),
            success: function(data) {
                $("#tblLineItems tbody").append(data);
                $("#lineIndex").val($("#tblLineItems tbody tr").length);
                $("#invoiceId").val(0);
                $(".neg-index").val(-1);
            }
        });
    }

    $(document).ready(function() {
        addLinesToTable();
    });
</script>
@if (Model.Invoice.Id == 0)
{
    <script>
        $(document).ready(function () {
            $("[name='Invoice.CustomerId']").val(-1);
            $("[name='Invoice.EmployeeId']").val(-1);
        });
    </script>
}

@using (Html.BeginForm("EditInvoice", "Admin", FormMethod.Post, new { id = "formEditInvoice" }))
{
    @Html.HiddenFor(f => f.Invoice.Id)
    @Html.Hidden("lineIndex", 0)
    @Html.Hidden("invoiceId", Model.Invoice.Id)
    <div class="card bg-light">
        <div class="card-header">
            <div class="row no-gutters">
                <div class="col-8">
                    <h2 class="m-0">Edit Invoice</h2>
                </div>
                <div class="col-4 text-right">
                    <button class="btn btn-success">@(Model.Invoice.Id == 0 ? "Generate New Invoice" : "Save Changes")</button>
                </div>
            </div>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-lg-9">
                    <div class="row">
                        <div class="col-md-3">
                            <label class="m-0 mt-2 text-muted">
                                Type
                            </label>
                            <select id="InvoiceType" name="InvoiceType" class="form-control form-control-sm">
                                <option value="invoice">Invoice</option>
                                <option value="quote">Quote</option>
                                <option value="donation">Donation</option>
                            </select>
                        </div>
                        <div class="col-md">
                            <label class="m-0 mt-2 text-muted">
                                Customer
                            </label>
                            @Html.DropDownListFor(f => f.Invoice.CustomerId, new SelectList(Model.Customers.OrderBy(o => o.DisplayName), "Id", "DisplayName", Model.Invoice.CustomerId), new { @class = "form-control form-control-sm select2" })
                        </div>
                        <div class="col-md">
                            <label class="m-0 mt-2 text-muted">
                                Employee
                            </label>
                            @Html.DropDownListFor(f => f.Invoice.EmployeeId, new SelectList(Model.Employees.OrderBy(o => o.EmployeeID), "EmployeeID", "EmpName", Model.Invoice.EmployeeId), new { @class = "form-control form-control-sm select2" })
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <label class="m-0 mt-2 text-muted">
                                Delivery
                            </label>
                            @Html.DropDownListFor(f => f.Invoice.ShippingMethod, new SelectList(new List<string> { "Shipment", "Delivery", "Pickup", "N/A" }, Model.Invoice.ShippingMethod), new { @class = "form-control form-control-sm select2" })

                            @*<select id="Invoice_ShippingMethod" name="Invoice.ShippingMethod" class="form-control form-control-sm">
                                    <option value="Shipment">Shipment</option>
                                    <option value="Delivery">Delivery</option>
                                    <option value="Pickup">Customer Pickup</option>
                                    <option value="N/A">N/A</option>
                                </select>*@
                        </div>
                        <div class="col-md-3">
                            <label class="m-0 mt-2 text-muted">
                                Shipping Cost
                            </label>
                            <div class="input-group input-group-sm">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">$</span>
                                </div>
                                @Html.TextBoxFor(f => f.Invoice.ShipCost, new { @class = "form-control form-control-sm", type = "number", step = "0.01" })
                            </div>
                        </div>
                        <div class="col-md-3">
                            <label class="m-0 mt-2 text-muted">
                                P.O. #
                            </label>
                            @Html.TextBoxFor(f => f.Invoice.Pofield, new { @class = "form-control form-control-sm" })
                        </div>
                        <div class="col-md-3">
                            <label class="m-0 mt-2 text-muted">
                                Due By
                            </label>
                            @Html.TextBox("Invoice.Deadline", Model.Invoice.Deadline == DateTime.MinValue ? "" : Model.Invoice.Deadline.ToString("yyyy-MM-dd"), new { type = "date", @class = "form-control form-control-sm" })
                        </div>
                    </div>
                </div>
                <div class="col-lg-3">
                    <label class="m-0 mt-2 text-muted">
                        Notes
                    </label>
                    @Html.TextAreaFor(f => f.Invoice.Notes, new { @class = "form-control small-text", rows = "5" })
                </div>
            </div>
            <hr class="mb-2" />
            <table class="table table-borderless table-sm table-responsive" id="tblLineItems">
                <thead>
                    <tr>
                        <th>Qty.</th>
                        <th>Type</th>
                        <th>Desc.</th>
                        <th>Price/ea.</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <div class="text-center">
                <button class="btn btn-info" type="button" onclick="addLinesToTable()">Add 5 More Rows</button>
            </div>
        </div>
    </div>
}